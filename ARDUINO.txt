/*
 * -THIS IS THE ARDUINO COMMUNICATION SECTION. IT CONSISTS ON READING THE NFC SENSOR AND SENDING THE UID TO THE NODE-MCU BOARD
 * 
 * -THE NFC READER USED IS THE PN532, TO CORRECTLY MAKE USE OF IT YOU MUST DOWNLOAD THE PN532 LIBRARY THAT IS ON GITHUB.  
 *  https://github.com/elechouse/PN532
 *  FOLLOW ALL THE STEPS THAT ARE PROVIDED. 
 * 
 * -VERY IMPORTANT::: I AM USING THE i2C MODE ON THE SENSOR. TO CHANGE THIS YOU MUST MANUALLY CHANGE THE SWITCH AS IT IS SHOWN IN THE TABLE OF THE SENSOR.
 * 
 * -PIN CONFIGURATION OF THE SENSOR:
 * *GND TO GND OF THE ARDUINO
 * *VCC TO 5V OF THE ARDUINO -> THE SENSOR CAN WORK WITH 3V AS-WELL
 * *SDA AND SCL TO SDA AND SCL RESPECTIVELY OF THE ARDUINO -> THESE ARE THE LAST TWO SOCKETS RIGHT ABOVE "AREF"
 * 
 * -PIN CONFIGURATION OF THE ARDUINO:
 * *PIN 2 TO THE D3 PIN OF THE NODE-MCU -> DO THIS AS A SEPARATE NODE, THERE IS ALSO LED CONNECTED FROM THIS PIN 
 * *PIN 1 TO THE RX PIN OF THE NODE-MCU
 * *YOU MAY WANT TO CREATE A COMMON GROUND BETWEEN THE ARDUINO AND THE NODE-MCU IN ORDER TO GET A CLOSED CIRCUIT 
 */


const int LED = 2;     // DIGITAL INPUT WHICH CHECKS WHETHER THE NODE-MCU IS AVAILABLE FOR READING.

// PN 532 CONFIGURATION
#if 0
#include <SPI.h>
#include <PN532_SPI.h>
#include <PN532.h>
#include <NfcAdapter.h>



PN532_SPI pn532spi(SPI, 10);
NfcAdapter nfc = NfcAdapter(pn532spi);
#else

#include <Wire.h>
#include <PN532_I2C.h>
#include <PN532.h>
#include <NfcAdapter.h>

PN532_I2C pn532_i2c(Wire);
NfcAdapter nfc = NfcAdapter(pn532_i2c);
#endif


void setup(void) {

    pinMode(LED, INPUT);           // SETTING UP THE READING PIN 
    Serial.begin(9600);            // STARTS THE SERIAL COMMUNICATION
    nfc.begin();
}

void loop(void) 
{
    Serial.flush();
    
    if(digitalRead(LED)!=LOW)     // IF NODE-MCU AVAILABLE THEN READ FROM SENSOR
    {
      if (nfc.tagPresent())       // CHECK IF THE SENSOR DETECTS SOMETHING
      {
         
          NfcTag tag = nfc.read();          // READS THE TAG
          String id = tag.getUidString();   // OBTAIN THE UID OF THE TAG
          
           Serial.print(id);
      }
      delay(1000);
    }
    
    delay(100);
}